<odoo>
  <data>
    <template id ='company_strategiksv_purchase_report_pdf'>
      <t t-call="web.html_container">
        <t t-call="web.basic_layout">
          <div class="page">
            <style class="text/css">
              @page {
                @bottom-left {
                  content: "Libro de compras";
                }
                @bottom-righ {
                content: counter(page) " de " counter(pages);
                }
              }
              .custom-footer:after {
                content: counter(page);
              }
            </style>
            <!--Declaracion de variables-->
            <t t-set="month" t-value="int(0)"/>
            <t t-set="year" t-value="int(0)"/>
            <t t-set="company_id" t-value="int(0)"/>
            <t t-set="contador" t-value="null"/>
            <t t-set="company" t-value="null"/>

            <t t-set="compra" t-value="float(0.00)"/>
            <t t-set="zero" t-value="float(0.00)"/>
            <t t-set="totalExentas" t-value="float(0.00)"/>
            <t t-set="totalGravadas" t-value="float(0.00)"/>
            <t t-set="totalIva" t-value="float(0.00)"/>
            <t t-set="totalRetenido" t-value="float(0.00)"/>
            <t t-set="totalPercibido" t-value="float(0.00)"/>
            <t t-set="totalCompras" t-value="float(0.00)"/>
            <t t-set="totalExcluidos" t-value="float(0.00)"/>
            <t t-set="totalRetenido3" t-value="float(0.00)"/>
            <t t-set="importacion" t-value="False"/>
            <!--Fin de declaraciones-->

            <!--Encabezado-->
              <t t-foreach="docs" t-as="o">
                <t t-set="month" t-value="int(data.get('form').get('date_month'))"/>
                <t t-set="year" t-value="int(data.get('form').get('date_year'))"/>
                <t t-set="company_id" t-value="int(data.get('form').get('company_id')[0])"/>
                <t t-set="contador" t-value="o.sv_aprueba_partida"/>
                <t t-set="company" t-value="o"/>
                <!--blockquote class="blockquote text-center">
                  <p class="mb-0">NOMBRE DEL CONTRIBUYENTE: <span t-field="o.name"/></p>
                  <p class="mb-0">LIBRO DE COMPRAS CON OPERACIONES DE RETENCIÓN</p>
                  <p class="mb-0">NIT: <span t-field="o.sv_nit"/> NRC: <span t-field="o.sv_nrc"/></p>
                  <p class="mb-0">MES: <span t-esc="o.get_month_str(month)"/> DE <span t-esc="year"/></p>
                  <p class="mb-0">VALORES EXPRESADOS EN DOLARES DE LOS ESTADOS UNIDOS</p>
                </blockquote-->
                <div style="background-color:lightgray" align="center">
                  <h2>NOMBRE DEL CONTRIBUYENTE: <span t-field="o.name"/></h2>
                  <h2>LIBRO DE COMPRAS CON OPERACIONES DE RETENCIÓN</h2>
                  <h2>NIT: <span t-field="o.sv_nit"/> NRC: <span t-field="o.sv_nrc"/></h2>
                  <h2>MES: <span t-esc="o.get_month_str(month)"/> DE <span t-esc="year"/></h2>
                  <h2>VALORES EXPRESADOS EN DOLARES DE LOS ESTADOS UNIDOS</h2>
                </div>
              </t>
            <!--Fin encabezado-->
            <!--Contenido de reporte-->
            <t t-foreach="company.get_purchase_details(company_id, year, month)" t-as="p">
              <table style="border: 1px solid black;">
                <div t-if="p_first" style="background-color:gray">
                <tr align="center" valign="middle">
                  <th colspan="5"></th>
                  <th colspan="2">COMPRAS EXENTAS</th>
                  <th colspan="3">COMPRAS GRAVADAS</th>
                  <th colspan="5"></th>
                </tr>
                <tr align="center" valign="middle">
                  <th valign="middle">#</th>
                  <th>Fecha de emisión</th>
                  <th>Número de documento</th>
                  <th>Nombre del proveedor</th>
                  <th>N.R.C.</th>
                  <th>Internas</th>
                  <th>Importaciones e Internacionales</th>
                  <th>Internas</th>
                  <th>Importaciones e Internacionales</th>
                  <th>Crédito fiscal</th>
                  <th>Anticipo a Cuenta de IVA Retenido</th>
                  <th>Anticipo a Cuenta de IVA Percibido</th>
                  <th>Total compras</th>
                  <th>Compras a Sujetos Excluidos</th>
                  <th>Retención a Terceros</th>
                </tr>
                </div>
                <tr t-foreach="company.get_purchase_details(company_id, year, month)" t-as="c">
                  <td><span t-esc="int(c_index) + 1"/></td>
                  <td><span t-field="c.get('fecha')"/></td>
                  <td><span t-field="c.get('factura')"/></td>
                  <td><span t-field="c.get('proveedor')"/></td>
                  <td><span t-field="c.get('nrc')"/></td>
                  <td><span t-esc="company.currency_id.symbol"/>
                      <span  t-if="c.get('importacion') != True" t-field="c.get('exento')"/>
                      <span  t-else="" t-esc="zero"/>
                  </td>
                  <td><span t-esc="company.currency_id.symbol"/>
                    <span t-if="c.get('importacion') == True" t-field="c.get('exento')"/>
                    <span t-else="" t-esc="zero"/>
                  </td>
                  <td><span t-esc="company.currency_id.symbol"/>
                    <span t-if="c.get('importacion') != True" t-field="c.get('gravado')"/>
                    <span t-else="" t-esc="zero"/>
                  </td>
                  <td><span t-esc="company.currency_id.symbol"/>
                    <span t-if="c.get('importacion') == True" t-field="c.get('gravado')"/>
                    <span t-else="" t-esc="zero"/>
                  </td>
                  <td><span t-esc="company.currency_id.symbol"/><span t-field="c.get('iva')"/></td>
                  <td><span t-esc="company.currency_id.symbol"/><span t-field="c.get('retenido')"/></td>
                  <td><span t-esc="company.currency_id.symbol"/><span t-field="c.get('percibido')"/></td>
                  <t t-set="compra" t-value="c.get('exento') + c.get('gravado') + c.get('iva') + c.get('retenido') + c.get('percibido')"/>
                  <td><span t-esc="company.currency_id.symbol"/><span t-esc="compra"/></td>
                  <td><span t-esc="company.currency_id.symbol"/><span t-field="c.get('excluido')"/></td>
                  <td><span t-esc="company.currency_id.symbol"/><span t-field="c.get('retencion3')"/></td>

                  <!--Calculo de totales-->
                  <t t-set="importacion" t-value="c.get('importacion')"/>
                  <t t-set="totalExentas" t-value="totalExentas + c.get('exento') "/>
                  <t t-set="totalGravadas" t-value="totalGravadas + c.get('gravado')"/>
                  <t t-set="totalIva" t-value="totalIva + c.get('iva')"/>
                  <t t-set="totalRetenido" t-value="totalRetenido + c.get('retenido')"/>
                  <t t-set="totalPercibido" t-value="totalPercibido + c.get('percibido')"/>
                  <t t-set="totalCompras" t-value="totalCompras + compra"/>
                  <t t-set="totalExcluidos" t-value="totalExcluidos + c.get('excluido')"/>
                  <t t-set="totalRetenido3" t-value="totalRetenido3 + c.get('retencion3')"/>
                  <!--Fin ce calculos-->

                </tr>
                <tr align="center">
                  <td>
                  </td>
                  <td>
                  </td>
                  <td>
                  </td>
                  <td>
                  </td>
                  <td>
                  </td>
                  <td><span t-esc="company.currency_id.symbol"/>
                      <span t-if="importacion != True" t-esc="totalExentas"/>
                      <span t-else="" t-esc="zero"/>
                  </td>
                  <td><span t-esc="company.currency_id.symbol"/>
                      <span t-if="importacion == True" t-esc="totalExentas"/>
                      <span t-else="" t-esc="zero"/>
                  </td>
                  <td><span t-esc="company.currency_id.symbol"/>
                      <span t-if="importacion != True" t-esc="totalGravadas"/>
                      <span t-else="" t-esc="zero"/>
                  </td>
                  <td><span t-esc="company.currency_id.symbol"/>
                      <span t-if="importacion == True" t-esc="totalGravadas"/>
                      <span t-else="" t-esc="zero"/>
                  </td>
                  <td>
                    <span t-esc="company.currency_id.symbol"/><span t-esc="totalIva"/>
                  </td>
                  <td>
                    <span t-esc="company.currency_id.symbol"/><span t-esc="totalRetenido"/>
                  </td>
                  <td>
                    <span t-esc="company.currency_id.symbol"/><span t-esc="totalPercibido"/>
                  </td>
                  <td>
                    <span t-esc="company.currency_id.symbol"/><span t-esc="totalCompras"/>
                  </td>
                  <td>
                    <span t-esc="company.currency_id.symbol"/><span t-esc="totalExcluidos"/>
                  </td>
                  <td>
                    <span t-esc="company.currency_id.symbol"/><span t-esc="totalRetenido3"/>
                  </td>
                </tr>
              </table>
            </t>

              <br/>

              <table align="center">
                <tr style="width: 100%;">
                  <td align="right">
                    <table class="table table-bordered" style="border: 1px solid black; border-collapse: collapse;">
                      <tr>
                        <td align="center" colspan="2">RESUMEN DE COMPRAS</td>
                      </tr>
                      <tr>
                        <td align="left">Compras Exentas:</td>
                        <td align="right"><span t-esc="company.currency_id.symbol"/>
                                          <span t-if="importacion != True" t-esc="totalExentas"/>
                                          <span t-else="" t-esc="zero"/>
                        </td>
                      </tr>
                      <tr>
                        <td align="left">Importaciones Exentas:</td>
                        <td align="right"><span t-esc="company.currency_id.symbol"/>
                                          <span t-if="importacion == True" t-esc="totalExentas"/>
                                          <span t-else="" t-esc="zero"/>
                        </td>
                      </tr>
                      <tr>
                        <td align="left">Compras Gravadas:</td>
                        <td align="right"><span t-esc="company.currency_id.symbol"/>
                                          <span t-if="importacion != True" t-esc="totalGravadas"/>
                                          <span t-else="" t-esc="zero"/>
                        </td>
                      </tr>
                      <tr>
                        <td align="left">Importaciones Gravadas:</td>
                        <td align="right"><span t-esc="company.currency_id.symbol"/>
                                          <span t-if="importacion == True" t-esc="totalGravadas"/>
                                          <span t-else="" t-esc="zero"/>
                        </td>
                      </tr>
                      <tr>
                        <td align="left">Crédito Fiscal:</td>
                        <td align="right"><span t-esc="company.currency_id.symbol"/><span t-esc="totalIva"/></td>
                      </tr>
                      <tr>
                        <td align="left">IVA Percibido:</td>
                        <td align="right"><span t-esc="company.currency_id.symbol"/><span t-esc="totalPercibido"/></td>
                      </tr>
                      <tr>
                        <td align="left">IVA Retenido:</td>
                        <td align="right"><span t-esc="company.currency_id.symbol"/><span t-esc="totalRetenido"/></td>
                      </tr>
                      <tr>
                        <td align="left">TOTAL:</td>
                        <td align="right"><span t-esc="company.currency_id.symbol"/><span t-esc="totalCompras"/></td>
                      </tr>
                    </table>
                  </td>
                  <td style="width: 30%"></td>
                  <td align="center" valign="bottom">
                    <table>
                      <tr>
                        <td align="center">_________________________________________</td>
                      </tr>
                      <tr>
                        <td align="center"><span t-esc="contador"/></td>
                      </tr>
                      <tr>
                        <td align="center">Contador</td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
            <!--/t-->

              <!--Pie de pagina-->
              <footer class="custom-footer" style="background-color: lightgray; bottom: 1; position: fixed; width: 100%; border-width: 55%;">
                <div class="row">
                    <p style="text-align: right">Pag. <span class="page"></span>
                    de
                    <span class="topage"></span></p>
                </div>
              </footer>
              <!-- Fin Pie de pagina-->
          </div>
        </t>
      </t>
    </template>
  </data>
</odoo>
